grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
glimpse
#------LOAD CORE TIDYVERSE & OTHER PACKAGES-------------------------------------------
##
library(readr)
library(tidyr)
library(dplyr)
library(tibble)
library(stringr)
library(lubridate)
library(janitor)
library(readxl)
library(openxlsx)
library(glue)
library(purrr)
rm(list = ls())
file_monthly <- "data_source/monthly/Relatorio Mensal de Carga Viral (Abril).xlsx"
#---- LOAD DATASETS AND UNION -------------------------------------------------------
xAge <- read_excel({file_monthly},
sheet = "S. Viral (Idade)", skip = 2) %>%
dplyr::mutate(group = "age") %>%
dplyr::select(-c(`SISMA ID`)) %>%
glimpse()
xSex <- read_excel({file_monthly},
sheet = "S. Viral (Genero)", skip = 2) %>%
dplyr::mutate(group = "sex") %>%
dplyr::select(-c(`SISMA ID`)) %>%
glimpse
xPW <- read_excel({file_monthly},
sheet = "S. Viral (M. Gravidas)", skip = 2) %>%
dplyr::mutate(group = "PW") %>%
dplyr::select(-c(`SISMA ID`)) %>%
dplyr::rename(US = HF,
PROVINCIA = PROVINCE,
DISTRITO = DISTRICT) %>%
glimpse
xLW <- read_excel({file_monthly},
sheet = "S. Viral (M. Lactantes)", skip = 2) %>%
dplyr::mutate(group = "LW") %>%
dplyr::select(-c(`SISMA ID`)) %>%
dplyr::rename(US = HF,
PROVINCIA = PROVINCE,
DISTRITO = DISTRICT) %>%
glimpse
df <- dplyr::bind_rows(xAge, xSex, xPW, xLW)
#---- RENAME VARIABLES -------------------------------------------------------
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
glimpse
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
glimpse
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
glimpse
View(df_1)
u
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL)
glimpse
View(df_1)
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
dplyr::mutate(total = `<1000` + `>1000`) %>%
glimpse
View(df_1)
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
dplyr::mutate(total = <1000 + >1000) %>%
glimpse
View(df_1)
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL)
View(df_1)
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(row = row_number()) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
dplyr::mutate(total = <1000 + >1000) %>%
glimpse
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(row = row_number()) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL)
View(df_1)
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator))
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(row = row_number(),
dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non-suppressed")) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL)
View(df_1)
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(row = row_number(),
dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non-suppressed")) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
glimpse
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(row = row_number(),
dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non-suppressed"))
View(df_1)
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non-suppressed"))
View(df_1)
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(result = dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non-suppressed"))
View(df_1)
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(result = dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non-suppressed")) %>%
dplyr::mutate(row = row_number()) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
glimpse
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(result = dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non_suppressed")) %>%
dplyr::mutate(row = row_number()) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
glimpse
View(df_1)
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(result = dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non_suppressed")) %>%
dplyr::mutate(row = row_number()) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
dplyr::mutate(suppressed = replace_na(suppressed, 0),
non_suppressed = replace_na(non_suppressed, 0))
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(result = dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non_suppressed")) %>%
dplyr::mutate(row = row_number()) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
dplyr::mutate(suppressed = replace_na(suppressed, 0),
non_suppressed = replace_na(non_suppressed, 0)) %>%
glimpse
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(result = dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non_suppressed")) %>%
dplyr::mutate(row = row_number()) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
dplyr::mutate(suppressed = replace_na(suppressed, 0),
non_suppressed = replace_na(non_suppressed, 0),
total = suppressed + non_suppressed)) %>%
glimpse
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(result = dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non_suppressed")) %>%
dplyr::mutate(row = row_number()) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
dplyr::mutate(suppressed = replace_na(suppressed, 0),
non_suppressed = replace_na(non_suppressed, 0),
total = suppressed + non_suppressed) %>%
glimpse
View(df_1)
month <- "2021-04-20"
df_1 <- df %>%
dplyr::select(-c(`CV < 1000`, `CV > 1000`, TOTAL)) %>%
dplyr::rename(province = PROVINCIA,
district = DISTRITO,
site = US,
age = Idade,
sex = Genero) %>%
tidyr::pivot_longer(`Rotina (<1000)`:`Motivo de Teste não especificado (>1000)`, names_to = "indicator", values_to = "value") %>%
dplyr::mutate(motive = dplyr::case_when(grepl("Rotina", indicator) ~ "Routine",
grepl("Fal", indicator) ~ "Theraputic Failure",
grepl("Repetir", indicator) ~ "Post Breastfeeding",
grepl("Motivo de Teste n", indicator) ~ "Not Specified"),
result = dplyr::case_when(grepl("<1000", indicator) ~ "<1000",
grepl(">1000", indicator) ~ ">1000")) %>%
dplyr::select(-c(indicator)) %>%
dplyr::mutate(result = dplyr::recode(result, "<1000" = "suppressed", ">1000" = "non_suppressed")) %>%
dplyr::mutate(row = row_number()) %>%
tidyr::pivot_wider(names_from = result, values_from = value, values_fill = NULL) %>%
dplyr::mutate(suppressed = replace_na(suppressed, 0),
non_suppressed = replace_na(non_suppressed, 0),
total = suppressed + non_suppressed,
month = {month}) %>%
glimpse
View(df_1)
output <- "2021-04.xlsx"
output <- "data_source/monthly_processed/2021-04.xlsx"
readr::write_csv(
df_1,
{output},
na ="")
output <- "C:/Users/jlara/Documents/GitHub/Lab/Lab/data_source/monthly_processsed/2021-04.xlsx"
readr::write_csv(
df_1,
{output},
na ="")
output <- "C:/Users/jlara/Documents/GitHub/Lab/Lab/data_source/monthly_processsed/2021-04.csv"
readr::write_csv(
df_1,
{output},
na ="")
readr::write_csv(
df_1,
{output},
na ="")
readr::write_tsv(
df_1,
{output},
na ="")
output <- "C:/Users/jlara/Documents/GitHub/Lab/Lab/data_source/monthly_processsed/2021-04.tsv"
readr::write_tsv(
df_1,
{output},
na ="")
library(readr)
library(tidyr)
library(dplyr)
library(tibble)
library(stringr)
library(lubridate)
library(janitor)
library(readxl)
library(openxlsx)
library(glue)
library(purrr)
rm(list = ls())
file_monthly <- "data_source/monthly/Janaury 2020 National VL data.xlsx"
month <- "2020-01-20"
output <- "C:/Users/jlara/Documents/GitHub/Lab/Lab/data_source/monthly_processsed/2020-01.tsv"
#---- LOAD DATASETS AND UNION -------------------------------------------------------
xAge <- read_excel({file_monthly},
sheet = "S. Viral (Idade)", skip = 2) %>%
dplyr::mutate(group = "age") %>%
dplyr::select(-c(`SISMA ID`)) %>%
glimpse()
